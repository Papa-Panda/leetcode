class Solution(object):
    def fourSum(self, nums, target):
        """
        :type nums: List[int]
        :type target: int
        :rtype: List[List[int]]
        """
        def helper(nums, target, N, result, results):
            if N < 2 or N > len(nums) or N * nums[0] > target  or N * nums[-1] < target:
                return
            if N == 2:
                l, r = 0, len(nums)-1
                while l < r:
                    if nums[l] + nums[r] == target:
                        results.append( result + [nums[l], nums[r]] )
                        l += 1
                        while l < r and nums[l] == nums[l-1]: l += 1
                    elif nums[l] + nums[r] < target:
                        l += 1
                    elif nums[l] + nums[r] > target:
                        r -= 1
            else:
                for i in range(len(nums)-N+1):
                    if i == 0 or (i > 0 and nums[i-1] != nums[i]):
                        helper((nums[i+1:]), target - nums[i], N -1, result + [nums[i]], results)
        res = []
        helper(sorted(nums), target, 4, [], res)
        return res
